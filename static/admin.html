<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 - 하루 한 개 질문 챌린지</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=Jua&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
    tailwind.config = {
        theme: {
            extend: {
                colors: {
                    'pastel-orange': '#FFB87A',
                    'pastel-coral': '#FF9B9B',
                    'pastel-yellow': '#FFE78A',
                    'pastel-green': '#8FE6B0',
                    'pastel-sky': '#8FC9F9',
                    'pastel-purple': '#C5B5E8',
                    'cream': '#FFFBF5',
                    'cream-dark': '#FFF3E0',
                    'txt': '#2D2424',
                    'txt-light': '#5C4E4E',
                    'txt-lighter': '#8E7E7E',
                },
                fontFamily: {
                    heading: ['"Jua"', 'sans-serif'],
                    body: ['"Gowun Dodum"', 'sans-serif'],
                }
            }
        }
    }
    </script>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body class="font-body bg-cream text-txt min-h-screen antialiased">
    <!-- Admin Login -->
    <div id="admin-login-screen" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-[#5D4037] to-[#8D6E63] p-6">
        <div class="bg-white p-8 rounded-2xl w-full max-w-[380px] shadow-lg">
            <h2 class="text-center font-heading text-xl mb-6">관리자 로그인</h2>
            <form id="admin-login-form">
                <div class="mb-4">
                    <label for="admin-username" class="block text-sm font-bold text-txt-light mb-1.5">아이디</label>
                    <input type="text" id="admin-username" placeholder="관리자 아이디" required class="w-full px-3.5 py-3 border-2 border-[#FFE0B2] rounded-xl text-base font-body bg-[#FFFBF5] focus:outline-none focus:border-pastel-orange focus:ring-2 focus:ring-pastel-orange/20 transition">
                </div>
                <div class="mb-4">
                    <label for="admin-password" class="block text-sm font-bold text-txt-light mb-1.5">비밀번호</label>
                    <input type="password" id="admin-password" placeholder="비밀번호" required class="w-full px-3.5 py-3 border-2 border-[#FFE0B2] rounded-xl text-base font-body bg-[#FFFBF5] focus:outline-none focus:border-pastel-orange focus:ring-2 focus:ring-pastel-orange/20 transition">
                </div>
                <button type="submit" class="w-full py-3.5 text-lg font-heading bg-gradient-to-r from-pastel-orange to-pastel-coral text-white rounded-full shadow-md hover:-translate-y-0.5 hover:shadow-lg active:translate-y-0 transition-all">로그인</button>
            </form>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="admin-dashboard" style="display:none">
        <header class="bg-gradient-to-r from-[#5D4037] to-[#795548] text-white sticky top-0 z-50 px-5 py-3.5">
            <div class="max-w-[900px] mx-auto flex items-center justify-between">
                <h1 class="font-heading text-lg">관리자 대시보드</h1>
                <div class="flex items-center gap-2">
                    <a href="/" class="text-xs px-3 py-1.5 rounded-lg border border-white/35 text-white/85 font-bold no-underline hover:text-white hover:border-white transition">학생 페이지</a>
                    <button id="admin-logout-btn" class="text-xs px-3 py-1.5 rounded-lg border border-white/35 text-white/85 font-bold hover:text-white hover:border-white transition">로그아웃</button>
                </div>
            </div>
        </header>

        <div class="max-w-[900px] mx-auto p-5">
            <!-- Topic Setting -->
            <div class="bg-white rounded-2xl p-5 shadow-md mb-5 border-2 border-pastel-green">
                <h3 class="text-base font-heading font-bold mb-3.5">시즌 주제 설정</h3>
                <p class="text-sm text-txt-light mb-3.5">
                    학생들이 질문을 올릴 때 상단에 표시되는 주제를 설정합니다.
                </p>
                <div class="flex gap-2 items-end flex-wrap">
                    <div class="flex-1 min-w-[160px]">
                        <label for="topic-input" class="block text-xs font-bold text-txt-light mb-1">현재 주제</label>
                        <input type="text" id="topic-input" placeholder="주제를 입력하세요" maxlength="50" class="w-full px-3.5 py-2.5 border-2 border-[#FFE0B2] rounded-xl text-base font-body bg-[#FFFBF5] focus:outline-none focus:border-pastel-green focus:ring-2 focus:ring-pastel-green/20 transition font-bold">
                    </div>
                    <button class="bg-gradient-to-r from-pastel-green to-[#5BB88A] text-white border-none px-5 py-2.5 rounded-xl text-sm font-bold font-body cursor-pointer hover:opacity-90 transition whitespace-nowrap" onclick="saveTopic()">
                        주제 저장
                    </button>
                </div>
            </div>

            <!-- Stats -->
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6">
                <div class="bg-white rounded-2xl p-4 text-center shadow-md">
                    <div class="text-3xl font-heading font-bold text-[#A04800]" id="stat-students">0</div>
                    <div class="text-sm text-txt-light mt-1 font-semibold">전체 참여 학생</div>
                </div>
                <div class="bg-white rounded-2xl p-4 text-center shadow-md">
                    <div class="text-3xl font-heading font-bold text-[#A04800]" id="stat-questions">0</div>
                    <div class="text-sm text-txt-light mt-1 font-semibold">전체 질문 수</div>
                </div>
                <div class="bg-white rounded-2xl p-4 text-center shadow-md">
                    <div class="text-3xl font-heading font-bold text-[#A04800]" id="stat-today">0</div>
                    <div class="text-sm text-txt-light mt-1 font-semibold">오늘 질문 수</div>
                </div>
                <div class="bg-white rounded-2xl p-4 text-center shadow-md">
                    <div class="text-3xl font-heading font-bold text-[#A04800]" id="stat-likes">0</div>
                    <div class="text-sm text-txt-light mt-1 font-semibold">전체 좋아요</div>
                </div>
            </div>

            <!-- Grade Stats -->
            <div class="bg-white rounded-2xl p-5 shadow-md mb-5">
                <h3 class="text-base font-heading font-bold mb-3.5">학년별 참여 현황</h3>
                <div id="grade-stats"></div>
            </div>

            <!-- Top Questions -->
            <div class="bg-white rounded-2xl p-5 shadow-md mb-5">
                <h3 class="text-base font-heading font-bold mb-3.5">인기 질문 TOP 10</h3>
                <div id="top-questions"></div>
            </div>

            <!-- Hall of Fame Reset -->
            <div class="bg-white rounded-2xl p-5 shadow-md mb-5 border-2 border-pastel-coral">
                <h3 class="text-base font-heading font-bold mb-3.5">명예의 전당 초기화</h3>
                <p class="text-sm text-txt-light mb-3.5">
                    명예의 전당 순위를 초기화합니다. 오늘 날짜부터 새로 집계가 시작됩니다.<br>
                    <strong class="text-pastel-green">기존 질문과 좋아요 데이터는 보존됩니다.</strong>
                </p>
                <button class="bg-pastel-coral text-white border-none px-5 py-2.5 rounded-xl text-sm font-bold font-body cursor-pointer hover:opacity-90 transition" onclick="resetHallOfFame()">
                    명예의 전당 초기화
                </button>
            </div>

            <!-- Student PIN Management -->
            <div class="bg-white rounded-2xl p-5 shadow-md mb-5">
                <h3 class="text-base font-heading font-bold mb-3.5">학생 비밀번호 관리</h3>
                <p class="text-sm text-txt-light mb-3.5">
                    학생 비밀번호를 확인하거나 초기화할 수 있습니다. 학생을 선택하고 비밀번호를 지정하여 생성할 수 있습니다.
                </p>

                <!-- 선택 학생 비밀번호 설정 영역 -->
                <div class="bg-cream-dark rounded-xl p-4 mb-4 border-2 border-pastel-orange/30">
                    <div class="flex items-center gap-2 mb-2.5">
                        <span class="text-sm font-heading font-bold">선택 학생 비밀번호 설정</span>
                        <span id="pin-selected-count" class="text-xs bg-white text-[#A04800] px-2.5 py-0.5 rounded-full font-bold">0명 선택</span>
                    </div>
                    <div class="flex gap-2 flex-wrap items-end">
                        <div class="flex-1 min-w-[140px]">
                            <label for="custom-pin" class="block text-xs font-bold text-txt-light mb-1">비밀번호 (숫자 4자리)</label>
                            <input type="text" id="custom-pin" inputmode="numeric" pattern="[0-9]{4}" maxlength="4" placeholder="예: 1234" class="w-full px-3 py-2.5 border-2 border-[#FFE0B2] rounded-xl text-base font-body bg-white focus:outline-none focus:border-pastel-orange focus:ring-2 focus:ring-pastel-orange/20 transition tracking-widest text-center font-bold">
                        </div>
                        <button class="bg-gradient-to-r from-pastel-orange to-pastel-coral text-white border-none px-4 py-2.5 rounded-xl text-sm font-bold font-body cursor-pointer hover:opacity-90 transition whitespace-nowrap" onclick="setCustomPins()">
                            선택 학생 비밀번호 설정
                        </button>
                    </div>
                </div>

                <!-- 기존 일괄 생성 버튼 -->
                <div class="flex gap-2 mb-3.5 flex-wrap">
                    <button class="bg-[#5C4E4E] text-white border-none px-3.5 py-2 rounded-xl text-sm font-bold font-body cursor-pointer hover:opacity-90 transition" onclick="generatePins('no_pin')">
                        미설정 학생 랜덤 비밀번호 생성
                    </button>
                    <button class="bg-pastel-coral text-white border-none px-3.5 py-2 rounded-xl text-sm font-bold font-body cursor-pointer hover:opacity-90 transition" onclick="generatePins('all')">
                        전체 랜덤 비밀번호 재생성
                    </button>
                </div>

                <!-- 필터 영역 -->
                <div class="flex gap-2 mb-3.5 flex-wrap items-center">
                    <select id="filter-grade" class="px-3 py-2 border-2 border-[#E8ECF4] rounded-xl font-body text-sm">
                        <option value="">전체 학년</option>
                        <option value="1">1학년</option>
                        <option value="2">2학년</option>
                        <option value="3">3학년</option>
                        <option value="4">4학년</option>
                        <option value="5">5학년</option>
                        <option value="6">6학년</option>
                    </select>
                    <input type="text" id="filter-name" placeholder="이름 검색..." class="px-3 py-2 border-2 border-[#E8ECF4] rounded-xl font-body text-sm flex-1 min-w-[120px]">
                    <label class="flex items-center gap-1.5 cursor-pointer text-sm font-bold">
                        <input type="checkbox" id="select-all-students" onchange="toggleSelectAllStudents(this)" class="w-4 h-4 cursor-pointer"> 전체 선택
                    </label>
                </div>
                <div id="student-list"></div>
            </div>

            <!-- Excel Export -->
            <div class="bg-white rounded-2xl p-5 shadow-md mb-5">
                <h3 class="text-base font-heading font-bold mb-3.5">엑셀 다운로드</h3>
                <p class="text-sm text-txt-light mb-3.5">날짜 범위를 선택하고 질문 데이터를 엑셀 파일(.csv)로 다운로드할 수 있습니다.</p>
                <div class="flex gap-2.5 items-center flex-wrap mb-3.5">
                    <label class="text-sm font-bold">시작일</label>
                    <input type="date" id="export-start" class="px-3 py-2 border-2 border-[#E8ECF4] rounded-xl font-body text-sm">
                    <label class="text-sm font-bold">종료일</label>
                    <input type="date" id="export-end" class="px-3 py-2 border-2 border-[#E8ECF4] rounded-xl font-body text-sm">
                </div>
                <div class="flex gap-2.5 flex-wrap">
                    <button class="bg-gradient-to-r from-pastel-orange to-pastel-coral text-white border-none px-4 py-2.5 rounded-xl text-sm font-bold font-body cursor-pointer hover:opacity-90 transition" onclick="downloadExcel('questions')">
                        질문 데이터 다운로드
                    </button>
                    <button class="bg-gradient-to-r from-pastel-green to-[#5BB88A] text-white border-none px-4 py-2.5 rounded-xl text-sm font-bold font-body cursor-pointer hover:opacity-90 transition" onclick="downloadExcel('students')">
                        학생별 통계 다운로드
                    </button>
                </div>
            </div>

            <!-- Question Management -->
            <div class="bg-white rounded-2xl p-5 shadow-md mb-5">
                <h3 class="text-base font-heading font-bold mb-3.5">질문 관리</h3>
                <div class="mb-3.5">
                    <input type="date" id="admin-date" class="px-3 py-2.5 border-2 border-[#E8ECF4] rounded-xl font-body text-sm">
                </div>
                <div id="admin-questions-list"></div>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script src="/static/js/admin.js"></script>
</body>
</html>
